HTTP协议

+ http（超文本传输协议）：一种无状态的，以请求应答方式运行的协议，它使用可扩展的语义和自描述消息格式，与基于网络的超文本信息系统灵活的互动。HTTP 协议自身不对请求和响应之间的通信状态进行保存，协议对于发送过的请求或响应都不做持久化处理
+ HTTP协议版本

| 版本     | 内容                                                         |
| -------- | ------------------------------------------------------------ |
| HTTP/0.9 | 不涉及数据包传输，规定客户端与服务端之间的通信格式，只能GET请求 |
| HTTP/1.0 | 传输内容格式不限制，增加PUT,PATCH,HEAD,OPTIONS,DELETE模式    |
| HTTP/1.1 | 持久链接（长链接），节约带宽，HOST域，管道机制，分块传输，编码 |
| HTTP/2   | 多路复用，服务器推送，头信息压缩，二进制协议等               |

## HTTP报文格式

+ HTTP协议的请求报文和响应报文的结构基本相同，由三大部分组成：

  + 起始行（start line）：描述请求或响应的基本信息
  + 头部字段集合（header）：使用kv形式更详细的说明了报文
  + 消息正文（entity）：实际传输的数据，他不一定是纯文本，可以是图片，视频等二进制数据

  ![HTTP协议格式](G:\knowledge\网络\images\HTTP协议格式.png)

### 请求行报文格式

![请求行报文格式](G:\knowledge\网络\images\请求行报文格式.png)

+ 请求方法：如GET/HEAD/PUT/POST/DELETE 表示对资源的操作
+ 请求目标：通常是一个URI，标记了请求方法要操作的资源
+ 版本号：表示报文使用的HTTP协议版本

#### 请求方法（Request Method）

+ GET：请求资源
+ POST：提交资源
+ HEAD：获取响应头，HEAD 方法和 GET 方法一样，只是不返回报文主体部分。用于确认URI 的有效性及资源更新的日期时间等。
+ PUT：替换资源
+ DELETE：删除资源
+ OPTIONS：查询针对请求 URI 指定的资源支持的方法
+ TRACE：回显服务器收到的请求，用于测试或者诊断
+ CONNECT：要求在与代理服务器通信时建立隧道，实现用隧道协议进行 TCP 通信。主要使用 SSL（Secure Sockets Layer，安全套接层）和 TLS（Transport Layer Security，传输层安全）协议把通信内容加 密后经网络隧道传输。

### 响应行报文格式

![响应行报文格式](G:\knowledge\网络\images\响应行报文格式.png)

+ 版本号：表示报文使用的HTTP协议版本
+ 状态码：一个三位数，用代码表示处理的结果，例如：200是成功，500是服务器错误
+ 原因：作为数字状态码补充，是更详细的解释文字，帮助人理解原因

#### 状态码（Status Code）

+ 状态码负责表示客户端 HTTP 请求的返回结果、标记服务器端的处理是否正常、通知出现的错误等工作

| 状态码 | 描述                      |
| ------ | ------------------------- |
| 1xx    | 提示信息，请求被成功接收  |
| 2xx    | 成功，请求呗成功处理：200 |
| 3xx    | 重定向相关：304           |
| 4xx    | 客户端错误：404           |
| 5xx    | 服务器错误：500           |

#### 常见状态码

| 常见状态码                   | 描述                                                         |
| ---------------------------- | ------------------------------------------------------------ |
| 200（OK）                    | 从客户端发来的请求在服务器端被正常处理了                     |
| 204（No Content）            | 服务器接收的请求已成功处理，但在返回的响应报文中不含实体的主体部分，另外，也不允许返回任何实体的主体 |
| 206（Partial Content）       | 客户端进行了范围请求，而服务器成功执行了这部分的GET 请求。响应报文中包含由 Content-Range 指定范围的实体内容 |
| 301（Moved Permanently）     | 永久性重定向。表示请求的资源已被分配了新的 URI，以后应使用资源现在所指的 URI。也就是说，如果已经把资源对应的 URI保存为书签了，这时应该按 Location 首部字段提示的 URI 重新保存。 |
| 302（Found）                 | 临时性重定向。该状态码表示请求的资源已被分配了新的 URI，希望用户（本次）能使用新的 URI 访问 |
| 303（See Other）             | 该状态码表示由于请求对应的资源存在着另一个 URI，应使用 GET方法定向获取请求的资源。 |
| 304（Not Modified）          | 该状态码表示客户端发送**附带条件的请求**时，服务器端允许请求访问资源，但未满足条件的情况。304 状态码返回时，不包含任何响应的主体部分。304 虽然被划分在 3XX 类别中，但是和重定向没有关系。 |
| 400（Bad Request）           | 该状态码表示请求报文中存在语法错误。当错误发生时，需修改请求的内容后再次发送请求。 |
| 401（Unauthorized）          | 该状态码表示发送的请求需要有通过 HTTP 认证（BASIC 认证、DIGEST 认证）的认证信息。另外若之前已进行过 1 次请求，则表示用 户认证失败。返回含有 401 的响应必须包含一个适用于被请求资源的 WWW-Authenticate 首部用以质询（challenge）用户信息。 |
| 403（Forbidden）             | 权限不足，该状态码表明对请求资源的访问被服务器拒绝了         |
| 404（Not Found）             | 没有找到，该状态码表明服务器上无法找到请求的资源             |
| 500（Internal Server Error） | 服务端内部错误。该状态码表明服务器端在执行请求时发生了错误。也有可能是 Web应用存在的 bug 或某些临时的故障。 |
| 503（Service Unavailable）   | 该状态码表明服务器暂时处于超负载或正在进行停机维护，现在无法处理请求 |

### HTTP头字段

+ 头部字段是KV的形式，key和value之间用":"分隔，最后用CRLF换行表示字段结束。例如：前后分离时经常遇到的要与后端协商传输数据的类型“Content-type:application/json”，这里的key就是Content-type，value就是application/json。HTTP头字段非常灵活，不仅可以使用标准里面的Host，connection等已有头，也可以任意添加自定义头，这就给了HTTP协议带来了无限的扩展可能
+ 头字段注意事项：
  + 字段名不区分大小写，字段名不允许出现空格，可以使用连字符"-"，但不能使用下户线"_"（有的服务器不会解析带"\_"的头字段）。字段名后面必须紧接着":"，不能有空格，而":"后的字段值前可以有多个空格
  + 字段的顺序是没有意义的，可以任意排序不影响语义
  + 字段原则上不能重复，除非这个字段本身的寓意允许：例如Set-Cookie
+ 常见头字段：HTTP协议中有非常多头字段，但基本可以分为以下类型
  + 请求字段：请求头中的头字段：Host，Referer
  + 响应字段：响应头中的头字段：Server
  + 通用字段：在请求头和响应头里面都可以出现：如Content-type，Connection

## 持久连接

+ HTTP 协议的初始版本中，每进行一次 HTTP 通信就要断开一次 TCP连接。因此，每次的请求都会造成无谓的 TCP 连接建立和断开，增加通信量的开销。在 HTTP/1.1 中，所有的连接默认都是持久连接，但在 HTTP/1.0 内并未标准化
+ 为解决上述 TCP 连接的问题，HTTP/1.1 和一部分的 HTTP/1.0 想出了持久连接（HTTP Persistent Connections，也称为 HTTP keep-alive 或HTTP connection reuse）的方法
+ 持久连接的特点是：在建立 1 次 TCP 连接后进行多次请求和响应的交互。只要任意一端没有明确提出断开连接，则保持 TCP 连接状态。
+ 持久连接的好处
  + 在于减少了 TCP 连接的重复建立和断开所造成的额外开销，减轻了服务器端的负载。
  + 减少开销的那部分时间，使HTTP 请求和响应能够更早地结束，这样 Web 页面的显示速度也就相应提高了。
  + 持久连接使得多数请求以管线化（pipelining）方式发送成为可能。从前发送请求后需等待并收到响应，才能发送下一个请求。管线化技术出现后，不用等待响应亦可直接发送下一个请求。这样就能够做到同时并行发送多个请求，而不需要一个接一个地等待响应了。

## Cookie

+ Cookie 技术通过在请求和响应报文中写入 Cookie 信息来控制客户端的状态
+ Cookie 会根据从服务器端发送的响应报文内的一个叫做 Set-Cookie 的首部字段信息，通知客户端保存 Cookie。当下次客户端再往该服务器发送请求时，客户端会自动在请求报文中加入 Cookie 值后发送出去。
+ 服务器端发现客户端发送过来的 Cookie 后，会去检查究竟是从哪一个客户端发来的连接请求，然后对比服务器上的记录，最后得到之前的状态信息。

## HTTP请求的完整过程

当用户在浏览器输入网址回车之后，网络协议都做了什么工作？

+ 首先干活的是浏览器应用程序，他要解析URL中的域名
+ 根据域名获取对应的IP地址，首先从网络缓存中查看，如果没有则从本机域名解析文件hosts(/etc/hosts)中查看，还是没有则要向DNS域名服务器发起域名解析请求拿到域名对应的IP
+ 拿到IP地址后，浏览器就可以与服务器建立TCP连接，发起三次握手
+ 握手建立之后，就开始组装HTTP请求报文，发送报文
+ 服务器收到请求报文后，开始请求报文解析，生成响应数据，发送响应数据
+ 浏览器收到响应后，开始渲染页面



# HTTPS协议

+ 由于HTTP天生“明文”传输的特点，整个传输过程都是完全透明，任何人都能够在链路中截取获得，修改或者伪造请求/响应报文，数据不具有可信性，所以为了安全而生的HTTPS协议就诞生了
+ 使用HTTPS时，所有的HTTP请求和响应在发送到网络之前，都要进行加密

## SSL/TLS

+ SSL为安全套接层，后面改名为TLS（传输层安全）

### 摘要算法

+ 摘要算法能够把任意长度的数据压缩成固定长度，而且独一无二的摘要字符串，就好像是给这段数据生产了一个数字指纹。任意微笑的数据差异，都可以生产完全不同的摘要。所以可以通过把明文信息的摘要和明文一起加密进行传输，数据传输到对方之后再进行解密，重新对数据进行摘要，再对比就能发现数据有没有被篡改。这样保证了完整性。
+ 常见的摘要算法：md5，sha1，sha2，sha256

### 对称密钥加密算法

+ 对称密钥加密算法：编码，解码使用相同的密钥算法，如（AES,RC4,ChaCha20）

### 非对称密钥加密算法

+ 对称密钥加密算法：他有两个密钥，一个叫公钥，一个叫私钥。两个密钥是不同的，公钥可以公开给任何人使用，私钥必须严格保密。非对称密钥加密算法可以解决“密钥交换”的问题。网址密钥保证私钥，在网上任意分发公钥，你想要登录网址只要用公钥加密就行，密文只能由私钥持有者才能解密。而黑客因为没有私钥，所以无法破解。非对称密钥加密算法通常需要大量的数据运算，所以比较慢。如（DH,DSA,RSA,ECC）
+ 使用公钥加密，只能使用私钥解密
+ 使用私钥加密，只能使用公钥解密

### 实际运用

+ TLS里使用的混合加密方式，即非对称密钥加密算法和对称密钥加密算法结合起来。两者互相取长补短，既能搞笑的加解密，又能安全的密钥交换。流程如下：
  1. 通信开始的时候使用非对称密钥加密算法如RSA,ECDHE先解决密钥交换的问题
  2. 用随机数产生对非对称密钥加密算法使用的“会话密钥”，再用公钥加密。会话密钥很短，所以即使使用非对称密钥加密算法也能快速完成加解密
  3. 对方拿到秘闻后用私钥解密，取出会话密钥。完成对称密钥的安全交换，后序就使用对称算法完成数据交换

## 身份验证

+ 数字证书组成：CA信息，公钥用户信息，公钥，权威机构的签名，有效期
+ 数字证书的作用：
  + 通过数字证书向浏览器证明身份，防止域名解析的时候被黑客拦截，返回了黑客的服务器IP，进行跟黑客服务器进行TCP连接通信
  + 数字证书里面包含了公钥，保证公钥不是伪造

# HTTP和HTTPS区别

+ HTTP特点：
  + 无状态：协议对客户端没有状态存储，对事物处理没有记忆能力。例如访问一个网站需要反复进行登录操作
  + 无连接：HTTP/1.1之前，由于无状态特点，每次请求需要通过TCP3次握手4次挥手，和服务器重新建立连接。例如某个客户机在短时间多次请求同一个资源，服务器并不能区别是否已经响应过用户的请求，所以每次都需要重新响应请求，需要消耗不必要的资源
  + 基于请求和响应：基本的特性，由客户端发起请求，服务端响应
  + 简单快速，灵活
  + 通信是使用**明文**，请求和响应不会对通信方进行确认，无法保护数据完整性
+ HTTPS特点：
  + 内容加密：采用混合加密技术，中间者无法直接查看明文内容
  + 验证身份，通过整数认证客户端访问的是不是正确的服务器
  + 保护数据完整性：防止传输的内容不被中间人冒充或者篡改