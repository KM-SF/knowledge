# HTTP协议

+ http（超文本传输协议）：一种无状态的，以请求应答方式运行的协议，它使用可扩展的语义和自描述消息格式，与基于网络的超文本信息系统灵活的互动

## HTTP报文格式

+ HTTP协议的请求报文和响应报文的结构基本相同，由三大部分组成：

  + 起始行（start line）：描述请求或响应的基本信息
  + 头部字段集合（header）：使用kv形式更详细的说明了报文
  + 消息正文（entity）：实际传输的数据，他不一定是纯文本，可以是图片，视频等二进制数据

  ![HTTP协议格式](G:\knowledge\网络\images\HTTP协议格式.png)

### 请求行报文格式

![请求行报文格式](G:\knowledge\网络\images\请求行报文格式.png)

+ 请求方法：如GET/HEAD/PUT/POST/DELETE 表示对资源的操作
+ 请求目标：通常是一个URI，标记了请求方法要操作的资源
+ 版本号：表示报文使用的HTTP协议版本

### 响应行报文格式

![响应行报文格式](G:\knowledge\网络\images\响应行报文格式.png)

+ 版本号：表示报文使用的HTTP协议版本
+ 状态码：一个三位数，用代码表示处理的结果，例如：200是成功，500是服务器错误
+ 原因：作为数字状态码补充，是更详细的解释文字，帮助人理解原因

### HTTP头字段

+ 头部字段是KV的形式，key和value之间用":"分隔，最后用CRLF换行表示字段结束。例如：前后分离时经常遇到的要与后端协商传输数据的类型“Content-type:application/json”，这里的key就是Content-type，value就是application/json。HTTP头字段非常灵活，不仅可以使用标准里面的Host，connection等已有头，也可以任意添加自定义头，这就给了HTTP协议带来了无限的扩展可能
+ 头字段注意事项：
  + 字段名不区分大小写，字段名不允许出现空格，可以使用连字符"-"，但不能使用下户线"_"（有的服务器不会解析带"\_"的头字段）。字段名后面必须紧接着":"，不能有空格，而":"后的字段值前可以有多个空格
  + 字段的顺序是没有意义的，可以任意排序不影响语义
  + 字段原则上不能重复，除非这个字段本身的寓意允许：例如Set-Cookie
+ 常见头字段：HTTP协议中有非常多头字段，但基本可以分为以下类型
  + 请求字段：请求头中的头字段：Host，Referer
  + 响应字段：响应头中的头字段：Server
  + 通用字段：在请求头和响应头里面都可以出现：如Content-type，Connection

## HTTP请求的完整过程

当用户在浏览器输入网址回车之后，网络协议都做了什么工作？

+ 首先干活的是浏览器应用程序，他要解析URL中的域名
+ 根据域名获取对应的IP地址，首先从网络缓存中查看，如果没有则从本机域名解析文件hosts(/etc/hosts)中查看，还是没有则要向DNS域名服务器发起域名解析请求拿到域名对应的IP
+ 拿到IP地址后，浏览器就可以与服务器建立TCP连接，发起三次握手
+ 握手建立之后，就开始组装HTTP请求报文，发送报文
+ 服务器收到请求报文后，开始请求报文解析，生成响应数据，发送响应数据
+ 浏览器收到响应后，开始渲染页面

# HTTPS协议

+ 由于HTTP天生“明文”传输的特点，整个传输过程都是完全透明，任何人都能够在链路中截取获得，修改或者伪造请求/响应报文，数据不具有可信性，所以为了安全而生的HTTPS协议就诞生了
+ 使用HTTPS时，所有的HTTP请求和响应在发送到网络之前，都要进行加密

## SSL/TLS

+ SSL为安全套接层，后面改名为TLS（传输层安全）

### 摘要算法

+ 摘要算法能够把任意长度的数据压缩成固定长度，而且独一无二的摘要字符串，就好像是给这段数据生产了一个数字指纹。任意微笑的数据差异，都可以生产完全不同的摘要。所以可以通过把明文信息的摘要和明文一起加密进行传输，数据传输到对方之后再进行解密，重新对数据进行摘要，再对比就能发现数据有没有被篡改。这样保证了完整性。
+ 常见的摘要算法：md5，sha1，sha2，sha256

### 对称密钥加密算法

+ 对称密钥加密算法：编码，解码使用相同的密钥算法，如（AES,RC4,ChaCha20）

### 非对称密钥加密算法

+ 对称密钥加密算法：他有两个密钥，一个叫公钥，一个叫私钥。两个密钥是不同的，公钥可以公开给任何人使用，私钥必须严格保密。非对称密钥加密算法可以解决“密钥交换”的问题。网址密钥保证私钥，在网上任意分发公钥，你想要登录网址只要用公钥加密就行，密文只能由私钥持有者才能解密。而黑客因为没有私钥，所以无法破解。非对称密钥加密算法通常需要大量的数据运算，所以比较慢。如（DH,DSA,RSA,ECC）
+ 使用公钥加密，只能使用私钥解密
+ 使用私钥加密，只能使用公钥解密

### 实际运用

+ TLS里使用的混合加密方式，即非对称密钥加密算法和对称密钥加密算法结合起来。两者互相取长补短，既能搞笑的加解密，又能安全的密钥交换。流程如下：
  1. 通信开始的时候使用非对称密钥加密算法如RSA,ECDHE先解决密钥交换的问题
  2. 用随机数产生对非对称密钥加密算法使用的“会话密钥”，再用公钥加密。会话密钥很短，所以即使使用非对称密钥加密算法也能快速完成加解密
  3. 对方拿到秘闻后用私钥解密，取出会话密钥。完成对称密钥的安全交换，后序就使用对称算法完成数据交换

## 身份验证

+ 数字证书组成：CA信息，公钥用户信息，公钥，权威机构的签名，有效期
+ 数字证书的作用：
  + 通过数字证书向浏览器证明身份，防止域名解析的时候被黑客拦截，返回了黑客的服务器IP，进行跟黑客服务器进行TCP连接通信
  + 数字证书里面包含了公钥，保证公钥不是伪造