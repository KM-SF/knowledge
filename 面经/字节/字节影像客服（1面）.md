## 知识点

+ 项目中使用Zookeeper来干什么

+ Zookeeper脑裂的话，你们怎么处理

  > 假死：由于心跳超时（网络原因导致的）认为master死了，但其实master还存活着。脑裂：由于假死会发起新的master选举，选举出一个新的master，但旧的master网络又通了，导致出现了两个master ，有的客户端连接到老的master 有的客户端链接到新的master。
  >
  > ZooKeeper默认采用了Quorums这种方式，即只有集群中超过半数节点投票才能选举出Leader。这样的方式可以确保leader的唯一性,要么选出唯一的一个leader,要么选举失败。在ZooKeeper中Quorums有2个作用：
  >
  > - 集群中最少的节点数用来选举Leader保证集群可用：通知客户端数据已经安全保存前集群中最少数量的节点数已经保存了该数据。一旦这些节点保存了该数据，客户端将被通知已经安全保存了，可以继续其他任务。而集群中剩余的节点将会最终也保存了该数据。
  > - 假设某个leader假死，其余的followers选举出了一个新的leader。这时，旧的leader复活并且仍然认为自己是leader，这个时候它向其他followers发出写请求也是会被拒绝的。因为每当新leader产生时，会生成一个epoch，这个epoch是递增的，followers如果确认了新的leader存在，知道其epoch，就会拒绝epoch小于现任leader epoch的所有请求。那有没有follower不知道新的leader存在呢，有可能，但肯定不是大多数，否则新leader无法产生。Zookeeper的写也遵循quorum机制，因此，得不到大多数支持的写是无效的，旧leader即使各种认为自己是leader，依然没有什么作用。
  >
  > 总结一下就是，通过Quorums机制来防止脑裂和假死，当leader挂掉之后，可以重新选举出新的leader节点使整个集群达成一致；当出现假死现象时，通过epoch大小来拒绝旧的leader发起的请求，在前面也已经讲到过，这个时候，重新恢复通信的老的leader节点会进入恢复模式，与新的leader节点做数据同步，perfect。

+ Zookeeper中的惊群效应如何解决

  > ZooKeeper 的节点通常可以作为分布式锁来使用。比如可以多个服务对同时竞争申请一个节点 “/test/lock”，创建成功的服务获取到这个锁，其他没创建成功的监听这个锁，等到这个锁释放后再重新申请该锁。这样就实现了简单的分布式锁。 但同时在大量锁的情况下会有**“惊群”**的问题。“惊群”就是在一个节点删除的时候，大量对这个节点的删除动作有订阅Watcher的线程会进行回调，这对Zk集群是十分不利的。所以需要避免这种现象的发生。
  >
  > 为了解决“惊群“问题，我们需要放弃订阅一个节点的策略，那么怎么做呢？
  >
  > 1. 我们将锁抽象成目录，多个线程在此目录下创建瞬时的顺序节点，因为Zk会为我们保证节点的顺序性，所以可以利用节点的顺序进行锁的判断。
  > 2. 首先创建顺序节点，然后获取当前目录下最小的节点，判断最小节点是不是当前节点，如果是那么获取锁成功，如果不是那么获取锁失败。
  > 3. 获取锁失败的节点获取当前节点上一个顺序节点，对此节点注册监听，当节点删除的时候通知当前节点。
  > 4. 当unlock的时候删除节点之后会通知下一个节点。

+ tcp中的三次握手过程

+ mysql中的索引是什么
  + 加快SQL查询速度的数据结构，引来的缺点（降低<u>更新表的速度</u>，保存<u>索引占用空间</u>）
  
+ 为什么使用了索引就比较快
  + 索引的数据结构一般有哈希索引和B+树索引，我们一般使用的都是innodb存储引擎，该引擎使用的是B+树索引。MySQL中的数据一般是放在磁盘中的，读取数据的时候肯定会有访问磁盘的操作， <u>B+Tree是专门为磁盘IO设计的一种多路平衡查找树</u>，它的**高度**远远小于其他数据结构，因此访问磁盘的数量极小，磁盘IO所花的时间少。
  
+ mysql的事务是怎么实现的
  + 通过隔离级别实现不同的事务等级
  
+ mysql的四种隔离级别
  + 读未提交，读已提交，可重复度，可串行化
  
+ 可重复读是怎么实现的呢
  + 通过MVCC实现
  
+ 什么是MVCC

> + 全称：Multi-Version-Concurrency Control，即多版本并发控制
> + 作用：为了解决并发情况下读写数据问题，提高数据库的并发性能
> + 同一行数据平时发生读写请求时，会加上锁阻塞，但是MVCC用更好的方式去处理读写请求，做到发生读写请求冲突时，不用加锁
> + 这个读是指快照读，而不是当前读，当前读是一种加锁操作，是悲观锁
> + MVCC是由：版本链和readview（读视图）组成。新数据的是否可见要看readview的创建时机

## 算法题

#### [122. 买卖股票的最佳时机 II](https://leetcode-cn.com/problems/best-time-to-buy-and-sell-stock-ii/)